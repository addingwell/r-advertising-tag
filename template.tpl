___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "categories": [
    "AFFILIATE_MARKETING",
    "ADVERTISING"
  ],
  "displayName": "R Advertising",
  "brand": {
    "id": "brand_dummy",
    "displayName": "Addingwell",
    "thumbnail": "data:image/jpeg;base64,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"
  },
  "description": "Tag to implement server-side cookie for R Advertising and setup concurrent tracking with server to server (S2S).",
  "containerContexts": [
    "SERVER"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "organizationId",
    "displayName": "Organization Id",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Your organization identifier on R Advertising",
    "alwaysInSummary": true
  },
  {
    "type": "TEXT",
    "name": "eventId",
    "displayName": "Event Id",
    "simpleValueType": true,
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ],
    "help": "Your event identifier on R Advertising",
    "alwaysInSummary": true
  },
  {
    "type": "CHECKBOX",
    "name": "clearCookie",
    "checkboxText": "Clear R Advertising cookie when receiving a purchase",
    "simpleValueType": true
  },
  {
    "type": "GROUP",
    "name": "standardParameters",
    "displayName": "Overwrite Standard Parameters",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "LABEL",
        "name": "label1",
        "displayName": "By default, it uses GA4 ecommerce fields"
      },
      {
        "type": "TEXT",
        "name": "transactionId",
        "displayName": "Unique transaction reference",
        "simpleValueType": true
      },
      {
        "type": "TEXT",
        "name": "purchaseAmount",
        "displayName": "Purchase amount (in EUR), without taxes and shipping",
        "simpleValueType": true
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "advancedParameters",
    "displayName": "Advanced Parameters",
    "groupStyle": "ZIPPY_CLOSED",
    "subParams": [
      {
        "type": "TEXT",
        "name": "pageViewEvent",
        "displayName": "Page view event name",
        "simpleValueType": true,
        "defaultValue": "page_view"
      },
      {
        "type": "TEXT",
        "name": "purchaseEvent",
        "displayName": "Purchase event name",
        "simpleValueType": true,
        "defaultValue": "purchase"
      },
      {
        "type": "TEXT",
        "name": "cookieExpiration",
        "displayName": "Cookie expiration in days",
        "simpleValueType": true,
        "defaultValue": 30,
        "valueValidators": [
          {
            "type": "POSITIVE_NUMBER"
          }
        ]
      },
      {
        "type": "TEXT",
        "name": "queryParam",
        "displayName": "Parameter URL name",
        "simpleValueType": true,
        "defaultValue": "tduid",
        "help": "Parameter name sent in URL by R Advertising"
      }
    ]
  }
]


___SANDBOXED_JS_FOR_SERVER___

const sendHttpRequest = require('sendHttpRequest');
const getAllEventData = require('getAllEventData');
const setCookie = require('setCookie');
const getCookieValues = require('getCookieValues');
const parseUrl = require('parseUrl');
const encodeUriComponent = require('encodeUriComponent');

const eventModel = getAllEventData();

const PAGE_VIEW_EVENT = data.pageViewEvent;
const PURCHASE_EVENT = data.purchaseEvent;


function safeEncodeComponent(value) {
  value = value || '';
  return encodeUriComponent(value);
}

switch (eventModel.event_name) {
  case PAGE_VIEW_EVENT:
    const parsedUrl = parseUrl(eventModel.page_location);
    const params = {};

    if (parsedUrl && parsedUrl.searchParams) {
      for (let param in parsedUrl.searchParams) {
        if (param.toLowerCase() === data.queryParam) {
          params.tduid = parsedUrl.searchParams[param];
          break;
        }
      }
    }

    if (params.tduid) {
      const value = params.tduid;

      const options = {
        domain: 'auto',
        path: '/',
        secure: true,
        httpOnly: false,
        'max-age': 86400 * data.cookieExpiration
      };
      setCookie('radv', value, options, false);
    }

    data.gtmOnSuccess();
    break;
  case PURCHASE_EVENT:
    const rAdvertisingCookie = getCookieValues('radv');

    if (!rAdvertisingCookie || !rAdvertisingCookie[0]) {
      data.gtmOnSuccess();
      break; 
    }

    const urlParams = [
      'organization=' + safeEncodeComponent(data.organizationId),
      'event=' + safeEncodeComponent(data.eventId),
      'tduid=' + safeEncodeComponent(rAdvertisingCookie[0]),
      'currency=EUR',
      'orderNumber=' + safeEncodeComponent(data.transactionId ? data.transactionId : eventModel.transaction_id),
      'orderValue=' + safeEncodeComponent(data.purchaseAmount ? data.purchaseAmount : (eventModel.value - (eventModel.tax || 0)) - (eventModel.shipping || 0)),
    ];

    const urlParamsString = urlParams.filter((v) => v).join('&');

    if (data.clearCookie) {
      setCookie('radv', '', {
        domain: 'auto',
        path: '/',
        secure: true,
        httpOnly: false,
        'max-age': 10
      }, false);
    }

    const requestHeaders = { method: 'GET' };
    const url = 'https://tbs.tradedoubler.com/report?' + urlParamsString;
    sendHttpRequest(url, (statusCode, headers, body) => {
      if (statusCode >= 200 && statusCode < 310) {
        data.gtmOnSuccess();
      } else {
        data.gtmOnFailure();
      }
    }, requestHeaders, '');
    break;
  default:
    data.gtmOnSuccess();
    break;
}


___SERVER_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "read_event_data",
        "versionId": "1"
      },
      "param": [
        {
          "key": "eventDataAccess",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_http",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedUrls",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://tbs.tradedoubler.com/report?*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "set_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "allowedCookies",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "name"
                  },
                  {
                    "type": 1,
                    "string": "domain"
                  },
                  {
                    "type": 1,
                    "string": "path"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "session"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "radv"
                  },
                  {
                    "type": 1,
                    "string": "*"
                  },
                  {
                    "type": 1,
                    "string": "/"
                  },
                  {
                    "type": 1,
                    "string": "secure"
                  },
                  {
                    "type": 1,
                    "string": "any"
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_cookies",
        "versionId": "1"
      },
      "param": [
        {
          "key": "cookieAccess",
          "value": {
            "type": 1,
            "string": "specific"
          }
        },
        {
          "key": "cookieNames",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "radv"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 2/15/2022, 16:06:45

